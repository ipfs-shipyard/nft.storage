type Upload {
  user: User! @relation
  type: UploadType!
  cid: String!
  content: Content! @relation
  created: Time!
  deleted: Time
  key: UserKey @relation
  files: [UploadFiles]
}

type UploadFiles @embedded {
  name: String
  type: String
}

enum UploadType {
  BLOB
  MULTIPART
  CAR
}

input CreateUploadFiles {
  name: String
  type: String
}

input CreatePin {
  status: PinStatus!
  statusText: String
  service: PinService!
}
input CreateUploadInput {
  type: UploadType!
  cid: String!
  dagSize: Int!
  files: [CreateUploadFiles]
  key: ID
  pins: [CreatePin]!
}

type Query {
  findUploadByCid(cid: String!): Upload! @resolver
  listUploads(size: Int!, before: String!): [Upload!]! @resolver
}

fragment UploadParts on Upload {
  _id
  type
  files {
    name
    type
  }
  cid
  type
  created
  key {
    name
  }
  content {
    dagSize
    pins {
      data {
        status
        service
        updated
        created
      }
    }
  }
}

query listUploads($size: Int!, $before: String!) {
  listUploads(size: $size, before: $before) {
    ...UploadParts
  }
}

query findUploadByCid($cid: String!) {
  findUploadByCid(cid: $cid) {
    ...UploadParts
  }
}

type Mutation {
  createUploadCustom(input: [CreateUploadInput!]!): [Upload!]! @resolver
}

mutation createUploadCustom($input: [CreateUploadInput!]!) {
  createUploadCustom(input: $input) {
    _id
    type
    cid
    created
    key {
      name
    }
    files {
      name
      type
    }
    user {
      issuer
    }
    content {
      cid
      dagSize
      pins {
        data {
          _id
          status
        }
      }
    }
  }
}

mutation deleteUpload($id: ID!) {
  deleteUpload(id: $id) {
    _id
  }
}
